import { API_KEY } from '@/constants/environment';
import { ApiResponse } from '@/types/api';
import { Rate } from '@/types/rates';

const mockedResponse: ApiResponse = {
  success: true,
  timestamp: 1750682945,
  base: Rate.EUR,
  date: '2025-06-23',
  rates: {
    AED: 4.209669,
    AFN: 81.272549,
    ALL: 97.880809,
    AMD: 442.18742,
    ANG: 2.051426,
    AOA: 1051.147775,
    ARS: 1334.831085,
    AUD: 1.795103,
    AWG: 2.063321,
    AZN: 1.951547,
    BAM: 1.954393,
    BBD: 2.312735,
    BDT: 140.089139,
    BGN: 1.954596,
    BHD: 0.432413,
    BIF: 3411.188652,
    BMD: 1.14629,
    BND: 1.481453,
    BOB: 7.943385,
    BRL: 6.339672,
    BSD: 1.145475,
    BTC: 1.1282601e-5,
    BTN: 99.357765,
    BWP: 15.49005,
    BYN: 3.74855,
    BYR: 22467.278021,
    BZD: 2.300874,
    CAD: 1.580097,
    CDF: 3297.87518,
    CHF: 0.938469,
    CLF: 0.028327,
    CLP: 1087.027552,
    CNY: 8.240103,
    CNH: 8.239484,
    COP: 4688.840683,
    CRC: 578.690927,
    CUC: 1.14629,
    CUP: 30.376677,
    CVE: 110.185669,
    CZK: 24.845876,
    DJF: 203.975811,
    DKK: 7.459707,
    DOP: 68.031019,
    DZD: 149.702019,
    EGP: 58.095339,
    ERN: 17.194345,
    ETB: 154.262353,
    EUR: 1,
    FJD: 2.606491,
    FKP: 0.851101,
    GBP: 0.856577,
    GEL: 3.118189,
    GGP: 0.851101,
    GHS: 11.79766,
    GIP: 0.851101,
    GMD: 81.969925,
    GNF: 9923.855028,
    GTQ: 8.812655,
    GYD: 239.6406,
    HKD: 8.998288,
    HNL: 29.915461,
    HRK: 7.534679,
    HTG: 150.341757,
    HUF: 404.122158,
    IDR: 18908.850921,
    ILS: 3.979969,
    IMP: 0.851101,
    INR: 99.420973,
    IQD: 1500.519657,
    IRR: 48287.453448,
    ISK: 142.976367,
    JEP: 0.851101,
    JMD: 182.58854,
    JOD: 0.812737,
    JPY: 169.0015,
    KES: 148.07807,
    KGS: 100.201308,
    KHR: 4591.754118,
    KMF: 490.036766,
    KPW: 1031.660837,
    KRW: 1591.697715,
    KWD: 0.351225,
    KYD: 0.954525,
    KZT: 598.277082,
    LAK: 24710.532279,
    LBP: 102631.450468,
    LKR: 344.664855,
    LRD: 229.088059,
    LSL: 20.758854,
    LTL: 3.384696,
    LVL: 0.693379,
    LYD: 6.237509,
    MAD: 10.492745,
    MDL: 19.679089,
    MGA: 5092.400214,
    MKD: 61.524447,
    MMK: 2406.93606,
    MNT: 4107.263987,
    MOP: 9.261953,
    MRU: 45.282398,
    MUR: 52.454432,
    MVR: 17.658564,
    MWK: 1986.19597,
    MXN: 22.067945,
    MYR: 4.923338,
    MZN: 73.316749,
    NAD: 20.758854,
    NGN: 1777.38012,
    NIO: 42.149653,
    NOK: 11.664673,
    NPR: 158.972623,
    NZD: 1.945122,
    OMR: 0.440709,
    PAB: 1.14539,
    PEN: 4.12463,
    PGK: 4.719602,
    PHP: 65.890455,
    PKR: 325.01723,
    PLN: 4.274755,
    PYG: 9142.417647,
    QAR: 4.188684,
    RON: 5.044593,
    RSD: 117.226475,
    RUB: 89.991948,
    RWF: 1654.030776,
    SAR: 4.301194,
    SBD: 9.560547,
    SCR: 16.510633,
    SDG: 688.358208,
    SEK: 11.167275,
    SGD: 1.481751,
    SHP: 0.900804,
    SLE: 25.734107,
    SLL: 24037.125959,
    SOS: 654.637241,
    SRD: 44.533194,
    STD: 23725.882336,
    SVC: 10.022784,
    SYP: 14903.920011,
    SZL: 20.75333,
    THB: 37.809797,
    TJS: 11.311204,
    TMT: 4.012014,
    TND: 3.396754,
    TOP: 2.684722,
    TRY: 45.523404,
    TTD: 7.784497,
    TWD: 34.100959,
    TZS: 3066.324946,
    UAH: 48.00194,
    UGX: 4133.024307,
    USD: 1.14719,
    UYU: 46.826286,
    UZS: 14314.693715,
    VES: 117.559692,
    VND: 30049.984354,
    VUV: 137.447958,
    WST: 3.162166,
    XAF: 655.493636,
    XAG: 0.031834,
    XAU: 0.000341,
    XCD: 3.097905,
    XDR: 0.813869,
    XOF: 655.485064,
    XPF: 119.331742,
    YER: 278.204897,
    ZAR: 20.77707,
    ZMK: 10317.978828,
    ZMW: 26.614187,
    ZWL: 369.104814,
  },
};

class ApiClient {
  async getRates(
    useMock: boolean = false,
  ): Promise<ApiResponse & { fetchedAt: number }> {
    if (useMock) {
      const waitTime = Math.random() * 2000 + 500;
      return new Promise(resolve => {
        setTimeout(() => {
          resolve({ ...mockedResponse, fetchedAt: Date.now() + waitTime });
        }, waitTime);
      });
    }

    try {
      const response = await fetch(
        `https://data.fixer.io/api/latest?access_key=${API_KEY}`,
      );
      const data = (await response.json()) as ApiResponse;
      console.log('Api call successfull');
      return { ...data, fetchedAt: Date.now() };
    } catch (error) {
      console.error(error);
      throw error;
    }
  }
}

export const api = new ApiClient();
